# Подробный гайд по деплою на Vercel с MongoDB Atlas

## Шаг 1: Настройка MongoDB Atlas

### 1.1. Создание учетной записи и кластера

1. Перейдите на [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/register) и создайте бесплатную учетную запись.
2. После входа в систему выберите "Build a Database" (Создать базу данных).
3. Выберите бесплатный тариф M0.
4. Выберите ближайший к вам регион (например, AWS / Europe).
5. Нажмите "Create Cluster" (Создать кластер).
6. Создание кластера может занять несколько минут.

### 1.2. Настройка доступа к базе данных

1. В левом меню выберите "Database Access" (Доступ к базе данных).
2. Нажмите "Add New Database User" (Добавить нового пользователя базы данных).
3. Выберите "Password" (Пароль) в качестве метода аутентификации.
4. Введите имя пользователя и пароль (сохраните их в надежном месте).
5. В разделе "Database User Privileges" (Привилегии пользователя базы данных) выберите "Read and Write to Any Database" (Чтение и запись в любую базу данных).
6. Нажмите "Add User" (Добавить пользователя).

### 1.3. Настройка сетевого доступа

1. В левом меню выберите "Network Access" (Сетевой доступ).
2. Нажмите "Add IP Address" (Добавить IP-адрес).
3. Чтобы разрешить доступ отовсюду (для разработки и деплоя на Vercel), выберите "Allow Access From Anywhere" (Разрешить доступ отовсюду) и нажмите "Confirm" (Подтвердить).
   - Примечание: в производственной среде следует ограничить доступ только IP-адресами Vercel.

### 1.4. Получение строки подключения

1. В левом меню выберите "Database" (База данных).
2. Нажмите "Connect" (Подключиться) рядом с вашим кластером.
3. Выберите "Connect your application" (Подключить приложение).
4. Выберите "Node.js" в качестве драйвера и соответствующую версию.
5. Скопируйте строку подключения, которая будет выглядеть примерно так:
   ```
   mongodb+srv://<username>:<password>@<cluster>.mongodb.net/?retryWrites=true&w=majority
   ```
6. Замените `<username>` и `<password>` данными, которые вы создали ранее.
7. Добавьте имя базы данных в строку подключения после доменного имени:
   ```
   mongodb+srv://<username>:<password>@<cluster>.mongodb.net/esports-mood-tracker?retryWrites=true&w=majority
   ```

## Шаг 2: Подготовка репозитория Git для Vercel

### 2.1. Убедитесь, что ваш репозиторий обновлен

```bash
git add .
git commit -m "Подготовка к деплою на Vercel с MongoDB Atlas"
git push
```

### 2.2. Проверьте наличие необходимых файлов

Убедитесь, что в вашем репозитории есть следующие файлы:
- `vercel.json` (с настройками для Vercel)
- обновленный `.env-example` (с примерами переменных окружения для MongoDB Atlas)
- обновленные скрипты сборки в `package.json`

## Шаг 3: Деплой на Vercel

### 3.1. Создайте аккаунт на Vercel

1. Перейдите на [Vercel](https://vercel.com/) и зарегистрируйтесь или войдите.
2. Для удобства рекомендуется войти с помощью вашей учетной записи GitHub, GitLab или Bitbucket, где находится ваш репозиторий.

### 3.2. Импортируйте ваш проект

1. В панели управления Vercel нажмите "Add New" (Добавить новый) -> "Project" (Проект).
2. Подключите свою учетную запись Git, если еще не сделали этого.
3. Выберите репозиторий с вашим проектом.
4. Vercel автоматически определит фреймворк (Vite + React).

### 3.3. Настройка проекта

1. На шаге "Configure Project" (Настройка проекта):
   - **Framework Preset**: Убедитесь, что выбран "Vite"
   - **Build Command**: Используйте стандартное значение `npm run build` или замените на `npm run vercel-build` если настроили этот скрипт
   - **Output Directory**: Убедитесь, что указан `dist`
   - **Install Command**: Стандартное значение `npm install`

2. Добавьте следующие переменные окружения (Environment Variables):
   - `MONGODB_URI` = строка подключения MongoDB Atlas, которую вы получили ранее
   - `JWT_SECRET` = надежный секретный ключ (можно сгенерировать с помощью [генератора паролей](https://passwordsgenerator.net/))
   - `NODE_ENV` = `production`
   - Добавьте другие необходимые переменные окружения из вашего `.env-example`

3. Нажмите "Deploy" (Деплой).

### 3.4. Подождите завершения деплоя

Vercel запустит процесс сборки и деплоя вашего приложения. Это может занять несколько минут.

### 3.5. Проверьте деплой

1. После успешного деплоя Vercel предоставит URL вашего приложения (например, `https://your-app-name.vercel.app`).
2. Проверьте, что ваше приложение работает корректно.
3. Проверьте подключение к MongoDB Atlas, попробовав функциональность, которая взаимодействует с базой данных.

## Шаг 4: Интеграция MongoDB Atlas с Vercel (опционально)

Vercel предлагает официальную интеграцию с MongoDB Atlas для упрощения подключения:

1. В панели управления Vercel перейдите в настройки вашего проекта.
2. Выберите вкладку "Integrations" (Интеграции).
3. Найдите "MongoDB Atlas" и нажмите "Add Integration" (Добавить интеграцию).
4. Следуйте инструкциям для подключения вашего кластера MongoDB Atlas.
5. После настройки Vercel автоматически добавит переменную окружения `MONGODB_URI`.

## Шаг 5: Управление и мониторинг

### 5.1. Управление деплоями в Vercel

1. В панели управления Vercel вы можете просматривать и управлять всеми деплоями вашего проекта.
2. Каждый коммит в вашу основную ветку автоматически вызывает новый деплой.
3. Вы можете настроить предварительные деплои для pull-запросов и тестирования изменений перед объединением.

### 5.2. Мониторинг базы данных в MongoDB Atlas

1. В панели управления MongoDB Atlas вы можете мониторить производительность и использование вашей базы данных.
2. Используйте вкладку "Metrics" (Метрики) для просмотра статистики использования.
3. Настройте оповещения, чтобы получать уведомления о проблемах с базой данных.

## Шаг 6: Оптимизация и масштабирование

### 6.1. Оптимизация производительности

1. Включите кэширование в Vercel для статических ресурсов.
2. Оптимизируйте запросы к MongoDB с помощью индексов.
3. Используйте функции Vercel Edge для улучшения скорости загрузки.

### 6.2. Масштабирование

1. При необходимости обновите свой кластер MongoDB Atlas до платного тарифа для увеличения хранилища и производительности.
2. Vercel автоматически масштабирует ваше приложение в зависимости от нагрузки.

## Поздравляем!

Теперь ваше приложение развернуто на Vercel и подключено к MongoDB Atlas. Ваш проект готов к использованию и дальнейшему развитию.

## Дополнительные ресурсы

- [Документация Vercel](https://vercel.com/docs)
- [Документация MongoDB Atlas](https://docs.atlas.mongodb.com/)
- [Интеграция MongoDB Atlas с Vercel](https://vercel.com/integrations/mongodbatlas) 